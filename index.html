<!DOCTYPE html>
<html>
  <head>
    <title>Speech Synthesis API</title>
    <script>
      let context;
      let recorder;
      let chunks = [];

      function speak() {
        const urlParams = new URLSearchParams(window.location.search);
        const text = urlParams.get('text');
        if (text) {
          const msg = new SpeechSynthesisUtterance();
          msg.text = text;
          msg.rate = 1; // adjust the rate as needed
          msg.onend = () => {
            recorder.stop();
          };
          const utterance = new SpeechSynthesisUtterance(text);
          speechSynthesis.speak(utterance);
          recorder.start();
        }
      }

      function init() {
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        context = new AudioContext();
        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
          recorder = new MediaRecorder(stream);
          recorder.ondataavailable = (event) => {
            chunks.push(event.data);
          };
          recorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'audio/wav' });
            const url = URL.createObjectURL(blob);
            const audio = new Audio(url);
            audio.controls = true;
            document.getElementById('audio').appendChild(audio);
          };
        });
      }
    </script>
  </head>
  <body onload="init(); speak()">
    <p>Speaking: <span id="text"></span></p>
    <div id="audio"></div>
  </body>
</html>
