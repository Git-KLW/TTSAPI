<!DOCTYPE html>
<html>
  <head>
    <title>Speech Synthesis API</title>
    <script>
      function speak() {
        const urlParams = new URLSearchParams(window.location.search);
        const text = urlParams.get('text');
        if (text) {
          const msg = new SpeechSynthesisUtterance();
          msg.text = text;
          const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          const gainNode = audioCtx.createGain();
          gainNode.gain.value = 0;
          const source = audioCtx.createMediaStreamDestination();
          const audioConfig = {type: 'audio/wav'};
          const recorder = new MediaRecorder(source.stream, audioConfig);
          recorder.start();
          msg.addEventListener('end', () => {
            recorder.stop();
            recorder.ondataavailable = (e) => {
              const audioBlob = new Blob([e.data], {type: 'audio/wav'});
              const audioUrl = URL.createObjectURL(audioBlob);
              const audio = new Audio(audioUrl);
              audio.play();
            };
          });
          window.speechSynthesis.speak(msg);
          const audioSource = audioCtx.createMediaElementSource(audio);
          audioSource.connect(gainNode).connect(source);
        }
      }
    </script>
  </head>
  <body onload="speak()">
    <p>Speaking: <span id="text"></span></p>
  </body>
</html>
