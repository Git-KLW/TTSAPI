<!DOCTYPE html>
<html>
  <head>
    <title>Speech Synthesis API</title>
    <script>
      function speak() {
        const urlParams = new URLSearchParams(window.location.search);
        const text = urlParams.get('text');
        if (text) {
                    // Create a new instance of SpeechSynthesisUtterance
          var msg = new SpeechSynthesisUtterance('Hello world');

          // Set up an event listener to capture the audio output
          msg.addEventListener('end', function() {
            var stream = new MediaStream();
            stream.addTrack(this.audioStream.getAudioTracks()[0]);

            var recorder = new MediaRecorder(stream);
            var chunks = [];

            recorder.ondataavailable = function(event) {
              chunks.push(event.data);
            }

            recorder.onstop = function() {
              var blob = new Blob(chunks, { 'type' : 'audio/ogg; codecs=opus' });
              // Do something with the recorded audio
            }

            recorder.start();
          });

          // Start the speech synthesis
          window.speechSynthesis.speak(msg);
        }
      }
    </script>
  </head>
  <body onload="speak()">
    <p>Speaking: <span id="text"></span></p>
  </body>
</html>
